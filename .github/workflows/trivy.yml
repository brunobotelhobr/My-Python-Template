
name: "SCA Trivy"

on:
  schedule:
    - cron: '39 3 * * 1'

jobs:
    scan:
      runs-on: ubuntu-latest
      permissions:
        actions: read
        contents: read
        security-events: write

      steps:
      - name: Download Code
        uses: actions/checkout@v2

      - name: SCA IAC
        uses: aquasecurity/trivy-action@master
        with:
          scan-type: "config"
          hide-progress: false
          format: "table"
          exit-code: "1"
          ignore-unfixed: true
          severity: "UNKNOWN,LOW,MEDIUM,HIGH,CRITICAL"
          skip-dirs: ./test

      - name: SCA Dependencies
        uses: aquasecurity/trivy-action@master
        with:
          scan-type: "fs"
          hide-progress: false
          format: "table"
          exit-code: "1"
          ignore-unfixed: true
          severity: "UNKNOWN,LOW,MEDIUM,HIGH,CRITICAL"
          skip-dirs: ./test
